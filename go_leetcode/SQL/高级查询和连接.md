# 力扣SQL高级查询与连接知识点总结

针对你列出的题目，我帮你整理了相关的高级查询和连接知识点：

## 一、连接查询(JOIN)基础

1. **内连接(INNER JOIN)**
   - 只返回两表中匹配的行
   - 示例：查询员工及其部门信息
   ```sql
   SELECT e.name, d.department_name
   FROM employees e
   JOIN departments d ON e.department_id = d.id
   ```

2. **左连接(LEFT JOIN)**
   - 返回左表所有行，右表不匹配则为NULL
   - 适用于"每位经理的下属员工数量"这类题目

3. **自连接(SELF JOIN)**
   - 同一表的不同实例连接
   - 常用于层级关系查询(如经理-下属关系)

## 二、分组统计(GROUP BY)

1. **COUNT()聚合函数**
   - 计算每组行数
   - 示例：统计每位经理的下属数量
   ```sql
   SELECT manager_id, COUNT(*) as subordinate_count
   FROM employees
   GROUP BY manager_id
   ```

2. **HAVING子句**
   - 对分组结果进行筛选(WHERE筛选行，HAVING筛选组)

## 三、窗口函数(Window Functions)

1. **ROW_NUMBER()**
   - 为结果集中的行分配唯一序号
   - 用于"最后一个能进入巴士的人"类题目

2. **RANK()和DENSE_RANK()**
   - 处理排名，适用于"连续出现的数字"类问题
   - 区别：RANK()会跳过相同排名的序号，DENSE_RANK()不会

3. **LAG()和LEAD()**
   - 访问当前行之前/之后的行
   - 常用于比较相邻行数据

## 四、日期处理

1. **日期比较和计算**
   - 用于"指定日期的产品价格"类题目
   - 函数：DATE(), DATE_ADD(), DATE_SUB(), DATEDIFF()等

## 五、条件逻辑

1. **CASE WHEN语句**
   - 实现条件分支逻辑
   - 示例：判断三角形类型
   ```sql
   SELECT 
     CASE 
       WHEN x + y > z AND x + z > y AND y + z > x THEN
         CASE 
           WHEN x = y AND y = z THEN '等边'
           WHEN x = y OR y = z OR x = z THEN '等腰'
           ELSE '普通'
         END
       ELSE '不是三角形'
     END AS triangle_type
   FROM triangles
   ```

## 六、常见解题模式

1. **层级查询模式**
   - 用于经理-下属关系类题目
   - 可能需要递归CTE(WITH RECURSIVE)

2. **连续性问题模式**
   - 使用窗口函数或自连接
   - 识别连续出现的记录

3. **最新记录问题**
   - 使用子查询或窗口函数获取每个组的最新记录

## 七、性能优化提示

1. 为连接字段和常用筛选字段创建索引
2. 避免在WHERE子句中对列使用函数，这会使索引失效
3. 对于复杂查询，考虑使用CTE(WITH子句)提高可读性

# 每位经理的下属员工数量



# 员工的直属部门



# 判断三角形



# 连续出现的数字



# 指定日期的产品价格



# 最后一个能进入巴士的人



# 按分类统计薪水