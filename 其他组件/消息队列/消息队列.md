#  消息队列

当某人进入抖音直播间购买一件商品的时候，可能会发生如下的案例

## 案例

### 案例(1)——系统崩溃

![案例1](../图片/消息队列/案例1.png)

如果此时数据库模块发生宕机，这个事件会整体卡死，应该如何处理？

![案例1解耦](../图片/消息队列/案例1解耦.png)

使用消息队列解耦，先顺利进行流程，之后再通过消息队列将数据存入存储服务

### 案例(2)——服务能力有限

如果一个服务只能处理100个并发量，面对超过的容量的应该如何处理？

![案例2解决](../图片/消息队列/案例2解决.png)

### 案例(3)——链路耗时长尾

![案例3](../图片/消息队列/案例3.png)

按照这个流程而言，每个用户抢到商品的需要经过30s左右，大部分时间消耗在通知商家的环节，应该如何优化

![案例三解决](../图片/消息队列/案例三解决.png)

使用消息队列，将耗时长的任务单独间隔开，实现用户响应的敏捷性

### 案例(4)——日志存储

如果本地日志丢失，应该如何追回或者恢复

![案例4解决](../图片/消息队列/案例4解决.png)

先将日志存储在消息队列里面，之后存储在一些搜索引擎类似的组件中

## 消息队列是什么

总结一下以上的案例，发现消息队列使用的场景有如下的特点

1. 将可能会报错的步骤单独隔离开
2. 将耗时较长的步骤单独隔离开
3. 在大量需求打入小型服务之前起到排队缓冲的作用
4. 将数据进行缓存

### 消息队列定义

消息队列(MQ)，指保存消息的一个容器，本质个队列。但这个队列呢，需要支持高吞吐，高并发，并且高可用![消息队列](../图片/消息队列/消息队列.png)

### 消息队列作用

**基础架构**

![img](D:/github/ByteDance_Backend/其他组件/图片/消息队列/Rabbitmq工作示意图.png)

**消息队列作用**

1. **解耦：** 系统服务和矩阵管理服务只需要发布订阅消息，每个节点去订阅消息即可，这样三个服务之间就完全解耦了

2. **异步：** 使用消息队列还有一个特别明显的好处，那就是可以将同步的逻辑异步化
3. **削峰:** 在未使用消息队列的系统中，系统面对突发大流量会导致系统崩溃。在使用消息队列之后，可以将大量消息积压在消息队列中，下游服务慢慢的从消息队列中消费即可

## 消息队列的发展

![消息队列实际组件](../图片/消息队列/消息队列实际组件.png)